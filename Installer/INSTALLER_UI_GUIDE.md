# Inno Setup 安裝程序 UI 指南

## 安裝流程

安裝程序包含以下配置頁面，按順序顯示：

### 1. **歡迎頁面** (預設)
- 顯示歡迎信息

### 2. **選擇安裝目錄** ⭐
- **頁面標題**：選擇安裝目錄
- **說明**：請選擇 WhatoFlow 的安裝位置
- **輸入欄位**：
  - 安裝目錄（可瀏覽選擇）
  - 預設：`C:\Program Files\WhatoFlow`

### 3. **後端端口配置** ⭐
- **頁面標題**：後端端口配置
- **說明**：配置 .NET 後端服務端口
- **輸入欄位**：
  - 端口號（數字，1-65535）
  - 預設：`64213`

### 4. **前端端口配置** ⭐
- **頁面標題**：前端端口配置
- **說明**：配置 React 前端服務端口
- **輸入欄位**：
  - 端口號（數字，1-65535）
  - 預設：`3000`

### 5. **數據庫伺服器配置** ⭐
- **頁面標題**：數據庫伺服器配置
- **說明**：配置 SQL Server 連接信息
- **輸入欄位**：
  - 伺服器 IP 或域名（例如：`127.0.0.1` 或 `sqlserver.company.com`）
  - 數據庫名稱（例如：`WhatoFlow`）
  - 預設值：伺服器=`127.0.0.1`，數據庫=`WhatoFlow`

### 6. **數據庫認證配置** ⭐
- **頁面標題**：數據庫認證配置
- **說明**：配置 SQL Server 登錄憑據
- **輸入欄位**：
  - 用戶名（例如：`sa`）
  - 密碼（隱藏輸入，使用 `*` 顯示）
  - 預設值：用戶名=`sa`，密碼=`sql!Q@W3e`

### 7. **選擇安裝類型** (預設)
- 完整安裝
- 自定義安裝

### 8. **安裝進度** (預設)
- 顯示文件複製進度

### 9. **完成頁面** (預設)
- 安裝完成

## 配置更新

所有用戶輸入的配置會自動更新到 `appsettings.json`：

```json
{
  "ConnectionStrings": {
    "PurpleRice": "Server=<用戶輸入的伺服器>;Database=<用戶輸入的數據庫>;User Id=<用戶輸入的用戶名>;Password=<用戶輸入的密碼>;TrustServerCertificate=true;"
  },
  "Ports": {
    "DotNet": <用戶輸入的 .NET 端口>,
    "NodeJs": <用戶輸入的 Node.js 端口>
  }
}
```

## 驗證規則

### 安裝目錄
- 必須選擇一個有效的目錄
- 不能為空

### 端口配置
- 必須是有效的數字
- 範圍：1-65535
- .NET 和 Node.js 端口不能相同

### 數據庫配置
- 伺服器地址：不能為空
- 數據庫名稱：不能為空
- 用戶名：不能為空
- 密碼：不能為空（但可以為空字符串，不推薦）

## 使用範例

### 範例 1：本地安裝
```
安裝目錄：C:\Program Files\WhatoFlow
.NET 端口：64213
Node.js 端口：3000
SQL Server：127.0.0.1
數據庫名稱：WhatoFlow
用戶名：sa
密碼：YourSecurePassword123
```

### 範例 2：遠程數據庫
```
安裝目錄：D:\Applications\WhatoFlow
.NET 端口：8080
Node.js 端口：3001
SQL Server：192.168.1.100
數據庫名稱：WhatoFlow_Prod
用戶名：whatoflow_user
密碼：********
```

## 技術細節

### 文件修改
- 安裝過程中會更新：`{app}\appsettings.json`
- 更新時機：在複製文件後、安裝服務前

### 特殊字符處理
- 密碼中的特殊字符會自動轉義（`\` → `\\`，`"` → `\"`）
- 確保 JSON 格式正確

### 錯誤處理
- 如果配置文件更新失敗，安裝會繼續但使用預設配置
- 建議檢查安裝日誌確認配置是否正確更新




